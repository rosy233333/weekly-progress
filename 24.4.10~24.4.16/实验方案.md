# 毕设实验方案

时间：2024/4/14

## 任务调度实验

使用 `apps/task/parallel` 测试。该程序会并行地对数组内所有元素求平方根再求和。其会创建多个线程（实验中，可以将其修改为协程），每个线程负责一部分元素的求平方根、汇总。

测试指标：计算需要的时间

比较对象：线程实现和协程实现

实验变量：并发量、CPU核心数

实验表格（每一项测试5次取平均）：

1. 固定核心数（4），改变并发量

|并发量|8|16|32|64|128|
|-|-|-|-|-|-|
|原情况||||||
|线程||||||
|协程||||||

2. 固定并发量（？），改变核心数

|核心数|1|2|3|4|5|
|-|-|-|-|-|-|
|原情况||||||
|线程||||||
|协程||||||

3. 在某个确定的核心数、并发量（4核，？）下多次实验，测量结果的分布

|测试次数|1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|
|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|
|原情况|||||||||||||||||||||
|线程|||||||||||||||||||||
|协程|||||||||||||||||||||

## 网络实验

使用 `apps/net/echoserver` 测试。其会运行一个TCP服务器，并创建线程来处理连接。

测试指标：（低负载下的）服务器响应时间、（高负载下的）吞吐率。

实验变量：包的大小

比较对象：线程实现/协程实现、原情况/专门轮询任务/中断

    原情况/专门轮询任务/中断的说明： `smoltcp` 使用 `poll` 函数来将 Socket 发送缓冲区中的内容传给网卡，将网卡接收缓冲区的内容处理后放入各个 Socket 的接收缓冲区。原情况为：在读写 Socket 前调用 `poll` ，若读 Socket 发现缓冲区空/写 Socket 发现缓冲区满的时候，则 yield，返回后再 `poll`，再读写。专门轮询任务：创建一个任务，定期调用`poll`。中断：在网卡中断到来时，调用`poll`。

实验表格（核心数固定为4，每一项测试5次取平均）：

1. 测量不同包大小下的响应时间

|包大小|||||||||
|-|-|-|-|-|-|-|-|-|
|原情况|||||||||
|仅修改任务调度模块|||||||||
|线程+轮询|||||||||
|线程+中断|||||||||
|协程+轮询|||||||||
|协程+中断|||||||||

2. 固定某个包大小，分析响应时间的分布

|测试次数|1|2|3|4|5|6|7|...|
|-|-|-|-|-|-|-|-|-|
|原情况|||||||||
|仅修改任务调度模块|||||||||
|线程+轮询|||||||||
|线程+中断|||||||||
|协程+轮询|||||||||
|协程+中断|||||||||

3. 建立不同数量的连接（以模拟不同负载的情况），测量吞吐率（连接个数/全部处理完成的时间）

|连接数量|5|10|15|20|25|30|
|-|-|-|-|-|-|-|
|原情况|||||||
|仅修改任务调度模块|||||||
|线程+轮询|||||||
|线程+中断|||||||
|协程+轮询|||||||
|协程+中断|||||||

## Redis 实验

使用 `apps/c/redis` 中的 redis 数据库软件进行实验。使用自带的 `redis-benchmark` 命令测试。

测试指标：每秒请求数

比较对象：线程实现/协程实现、原情况/专门轮询任务/中断

实验表格（核心数固定为4）：

测试命令：`redis-benchmark -p 5555 -n 100 -c 50`

|并发量|10|20|30|40|50|
|-|-|-|-|-|-|
|线程+原情况||||||
|线程+轮询||||||
|线程+中断||||||
|协程+轮询||||||
|协程+中断||||||