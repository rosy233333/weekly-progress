# 操作系统专题训练课笔记

时间：2023/12/31

## 用户态中断

有什么作用？微内核各个模块都是独立进程，模块间通信需要进行IPC，但IPC一般开销较大。用户态驱动也需要IPC。使用用户态中断，可以降低IPC的开销

![](../图片/屏幕截图%202023-12-31%20104715.png)

![](../图片/屏幕截图%202023-12-31%20105125.png)

### 项晨东：在QEMU里实现用户态中断

![](../图片/屏幕截图%202023-12-31%20105245.png)

用用户态中断的通知机制，可以实现异步系统调用

![](../图片/屏幕截图%202023-12-31%20105644.png)

    linux io_uring：Linux提供的一个异步IO机制，用户将IO任务提交到一个队列中，就可以去做别的事。系统内核负责从队列中取任务，完成后放到完成队列。用户需要检查完成队列，以判断自己提交的任务是否完成。

在此机制上做改进，内核完成任务之后，马上用用户态中断通知对应的用户程序

![](../图片/屏幕截图%202023-12-31%20111106.png)

指令捕捉，新增寄存器/状态，反馈特性/内存读写，中断发送/接收，

![](../图片/屏幕截图%202023-12-31%20123043.png)

![](../图片/屏幕截图%202023-12-31%20123307.png)

![](../图片/屏幕截图%202023-12-31%20123729.png)

## 并发

CPU、操作系统、编程语言均实现了不同的并发机制

- CPU：中断，打断执行流
- 操作系统：进程、内核线程
- 编程语言、用户库：用户线程、协程

![](../图片/屏幕截图%202023-12-31%20151610.png)

在没有用户态中断的情况下，信号处理需要进出两次内核态。因为信号的检测需要在中断处理程序（内核态）中执行，信号的处理需要在用户态执行

语言层面的并发机制（特别是异步机制）和操作系统关系不大，将其与操作系统结合，即为异步操作系统。

![](../图片/屏幕截图%202023-12-31%20153045.png)

![](../图片/屏幕截图%202023-12-31%20153115.png)

![](../图片/屏幕截图%202023-12-31%20153242.png)

![](../图片/屏幕截图%202023-12-31%20153159.png)

![](../图片/屏幕截图%202023-12-31%20153423.png)

## 共享调度器

![](../图片/屏幕截图%202023-12-31%20153823.png)