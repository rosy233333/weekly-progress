# 毕设总结文档

时间：2024/6/8

本文档总结我毕设的开发过程与经验教训，对毕设具体内容的描述请参阅[毕设论文](https://gitee.com/LC_rosy/weekly-progress/blob/master/24.5.29~24.6.4/10007_%E5%9C%A8QEMU%E6%A8%A1%E6%8B%9F%E5%99%A8%E4%B8%AD%E7%9A%84%E5%85%B1%E4%BA%AB%E8%B0%83%E5%BA%A6%E5%99%A8%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0.pdf)。

## 过程简述

### 12.5 ~ 1.1 调研和学习阶段

本阶段中，首先初步学习了Rust Future相关知识。但对Waker、Reactor等概念还未完全弄懂。也对QEMU进行了调研，但找不到切入点，对如何在QEMU中新增硬件没有头绪。

在此阶段中，也细读了学长的几篇推荐的文献，以及为了准备开题而略读了一些论文。这使我对任务调度方向的研究有基本的了解（但现在还未了解中断处理方向）。在此基础上，完成了开题工作（报告文档+汇报），规划了时间安排。

### 12.12 ~ 1.25 QEMU开发阶段

我阅读了学长的开发文档，理解了学长对硬件调度器的设计方案。

学长在QEMU中编写了框架代码。我通过阅读这些代码，并与原有的PLIC代码对比，了解了在QEMU中开发硬件的方法，包括QOM对象模型、MMIO在QEMU中的实现、QEMU中的简单队列，等等。

之后与学长一起开发，完成了QEMU中硬件调度器的开发工作。

本阶段的我对已有源代码的阅读和修改能力还不熟练，且QEMU源代码本身较为复杂，因此很多工作都是在学长的帮助下完成的。

### 2.26 ~ 4.30 ArceOS开发阶段

首先进一步理解了Rust Future相关内容，弄懂了之前未明白的问题。

之后开始ArceOS内的修改。首先的计划是，以用户程序的形式实现协程调度器（由于ArceOS的unikernel特性，用户程序与系统一同在内核态运行）。该方案的工作量很小。但由于需要运行Redis作为测试程序的需求，原有方案不合要求，修改为了“修改ArceOS内原有的任务调度模块使其同时支持线程和协程，并且使用协程优化ArceOS网络模块”的方案，工作量较大。

与学长讨论和确定了任务调度模块的修改方案。由于需要使原本只支持线程的任务模块同时支持线程与协程，因此修改的代码量很大。由于修改程度过大，修改完成的系统出现了很多bug，修复这些bug花费了很多的时间和精力，终于使系统较为稳定（但bug仍未全部修改完成）。由于对原有系统的破坏式修改过多，我与学长在ArceOS上的工作也开始分离，使用了不同的工作分支。

之后开始修改网络模块，根据之前看过的论文制定了修改方案并开始修改。开发过程的工作量不大，不过之后测试时发现了一个导致死锁的bug，将其定位和修改花费了一些时间。

在本阶段期间，也完成了中期工作（报告文档+汇报）。

### 4.23 ~ 5.31 实验、撰写论文、答辩

在实验阶段中，我原本的实验方案比较简陋，实验组数和测试的影响因素数量都不多。之后我学习组内其它同学、学长的实验方式和数据处理方式，完善了自己的实验方案，并按照方案开展了实验、处理了数据，使用折线图、分布直方图等多种图表展示实验数据。

从4月底开始，主要工作为撰写论文、准备答辩。并且，也按照老师的意见修改论文和答辩稿。

## 过程中的收获

1. 提升了阅读和修改中大型项目的源代码的能力、设计实验的能力。
2. 在编写代码过程中，要时刻保持代码的条理，并且修改幅度尽可能小、对已有代码的耦合和修改尽可能小。
3. 需要注重与学长的交流，一方面提高我们开发工作地可复用程度，另一方面需要有自己独立的工作成果。
4. 需要进行大规模开发/修改时，更频繁地进行单元测试，尽早发现和解决bug。
5. 注重调研工作，更加了解该方向的前沿研究，更清楚自己研究的意义。